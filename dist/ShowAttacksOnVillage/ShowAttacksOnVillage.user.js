// ==UserScript==
// @name         ShowAttacksOnVillage
// @namespace    https://github.com/LegendaryB/tw-userscripts
// @version      0.1
// @author       LegendaryB
// @match		 https://*.die-staemme.de/game.php*&screen=place&try=confirm
// @icon         https://www.google.com/s2/favicons?sz=64&domain=die-staemme.de
// @grant        none
// ==/UserScript==

(()=>{"use strict";class e{static InfoMessage(e){window.UI.InfoMessage(e)}static SuccessMessage(e){window.UI.SuccessMessage(e)}static ErrorMessage(e){window.UI.ErrorMessage(e)}}var t;class a{static registerTranslationProvider(e,t){this.translationProviderMap.set(e,t)}static unregisterTranslationProvider(e){this.translationProviderMap.delete(e)}static getPropertyKeyByHandlebar(e){return e.replace("{{","").replace("}}","")}}t=a,a.translationProviderMap=new Map,a.translate=e=>{let a=t.translationProviderMap.get(window.game_data.locale);return a?a[e]:"ERROR! NO TRANSLATION!"},a.translateAndReplace=e=>{let a=e.match(/{{{?(#[a-z]+ )?[a-z]+.[a-z]*}?}}/gi);if(!a)return e;for(const r of a){let a=t.getPropertyKeyByHandlebar(r),n=t.translate(a);e=e.replace(r,n)}return e},new a,window.game_data.world;(async()=>{const t="ShowAttacksOnVillageHeader",a=`\n        <table class="vis">\n            <tbody>\n                <tr id="${t}">\n                    <th colspan="2">\n                        Ankommende Truppen\n                    </th>\n                </tr>\n            </tbody>\n        </table>`,r=document.querySelector(".village_anchor").querySelector("a").href,n=await(async e=>(await(async e=>{try{let t=await fetch(e),a=await t.text();return(new DOMParser).parseFromString(a,"text/html")}catch(e){return}})(e)).querySelectorAll(".command-row"))(r);if(0===n.length)return void e.InfoMessage("Keine Befehle für das Zieldorf gefunden");const s=document.getElementById("command-data-form").querySelector("div");s.style.display="table-row",s.querySelector("table").style.float="left",s.insertAdjacentHTML("beforeend",a);let l=document.getElementById(t);for(const e of n)e.removeChild(e.cells[e.cells.length-1]),l.after(e),l=e;e.SuccessMessage("Befehle für das Zieldorf geladen")})()})();